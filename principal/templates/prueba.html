<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
       <!-- <link rel="stylesheet" type="text/css" href="http://code.jquery.com/mobile/1.4.0/jquery.mobile-1.4.0.min.css" />-->
        <title>TH | Bienvenido</title>
    </head>
    <body>

		<div id="request">Hola1</div>
		<div id="request2">Hola2</div>
		<div id="request3">Hola3</div>		
		
		

        <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
        <!--<script type="text/javascript" src="http://code.jquery.com/mobile/1.4.0/jquery.mobile-1.4.0.min.js"></script>-->
	
		<script type="text/javascript">

			$(document).ready(function(){
				//http://stackoverflow.com/questions/17735465/sending-a-jquery-request-to-django-rest-framework-results-in-no-found-json-objec
				login();
			});
			
			function login(){
				$.ajax({
		            async:	true,
		            success:r,
		            data:	{"username":"admin", "password":"pasa"},
		            url:	"http://127.0.0.1:8000/loginMovil/",
		            type:	"POST",
		            dataType:"jsonp",
					error: function(errorThrown){
	        			console.log('ErrorLogin');
	        			console.log(errorThrown);
		    		}
				});
				

				$.ajax({
		            async:	true,
		            success:r,
		            url:	"http://127.0.0.1:8000/api/busquedas",
		            type:	"GET",
		            dataType:"jsonp",
					error: function(errorThrown){
	        			console.log('ErrorBusquedas');
	        			console.log(errorThrown);
		    		}		            
				});
				

				
				/*
				$.ajax({
		            async:	true,
		            success:r,
		            url:	"http://127.0.0.1:8000/logoutMovil/",
		            type:	"GET",
					dataType:"jsonp",
					error: function(errorThrown){
	        			console.log('ErrorLogout');
	        			console.log(errorThrown);
		    		}
				});
				*/
				/*
				$.ajax({
		            async:	true,
		            success:r,
		            data:	{
					    "username": "", 
					    "password": "", 
					    "first_name": "", 
					    "last_name": "", 
					    "email": "", 
					    "px": 0, 
					    "py": 0
					},
		            url:	"http://127.0.0.1:8000/api/users/",
		            type:	"POST",
		            dataType:"jsonp"
				});*/
				
			}
			
			function r(json){
				console.log("HOLA");
				console.log(json);
			}
			//https://docs.djangoproject.com/en/dev/ref/contrib/csrf/
			/*function csrfSafeMethod(method) {
			    // these HTTP methods do not require CSRF protection
			    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
			}
			$.ajaxSetup({
			    crossDomain: false, // obviates need for sameOrigin test
			    beforeSend: function(xhr, settings) {
			        if (!csrfSafeMethod(settings.type)) {
			            xhr.setRequestHeader("X-CSRFToken", csrftoken);
			        }
			    }
			});*/
				/*		
			/*function login(){
				console.log("Hola1");
				var url="http://127.0.0.1:8000/api/tesoros/";
					//url="http://127.0.0.1:8000/api-auth/login/";
				var parametros = 'srfmiddlewaretoken: {{csrf_token}}';
				//{"p1":"valor1", "p2":"valor2"};
				
				
				 $.getJSON(url, {}, r);/*function(json){
		            //$('#resquest').html(json.busquedas+'('+json.tesoros+')');
		            console.log(json);
		        });
				
				$.ajax({
		            async:	true,
		            success:r2,
		            data:	parametros,
		            url:	"http://127.0.0.1:8000/api-auth/login/",
		            type:	"POST",
		            dataType:"json"
				});
				/*$.getJSON( "http://127.0.0.1:8000/api/", function( json ) {
					console.log( "JSON Data: " );
					//console.log(json);
				});
				//$( "#request2" ).load( url );
				
				

				console.log("Hola2");
			}
			
			function r(json){
				console.log("Hola3");
				console.log(json);
			}
			
			function r2(json){
				console.log("Hola4");
				console.log(json);
			}
			
			
		//login
		
		$.ajax({
		    url: '/accounts/signin/',
		    type: 'POST',
		    data: {
		        csrfmiddlewaretoken: '{{csrf_token}}',
		        //other variables
		    },
		    success: function() {
		        alert('Test');
		        $('#datadisplay').append("<h2>It worked</h2>");
		    },  
		    error: function(errorThrown){
		        alert('Error');
		        alert(errorThrown);
		    }
		});
		
		/*$.ajax({
    	url: '/myresource/',
    	method: 'POST',
    	headers: {'X-HTTP-Method-Override': 'PATCH'},
    	...
		});*/


	//jquery mobile
	/*
		$( document ).on( "pageinit", "#myPage", function() {
		    $( "#autocomplete" ).on( "listviewbeforefilter", function ( e, data ) {
		        var $ul = $( this ),
		            $input = $( data.input ),
		            value = $input.val(),
		            html = "";
		        $ul.html( "" );
		        if ( value && value.length > 2 ) {
		            $ul.html( "<li><div class='ui-loader'><span class='ui-icon ui-icon-loading'></span></div></li>" );
		            $ul.listview( "refresh" );
		            $.ajax({
		                url: "/get_names/",
		                dataType: "json",
		                crossDomain: true,
		                data: {
		                    term: $input.val()
		                }
		            })
		            .then( function ( response ) {
		                $.each( response, function ( i, val ) {
		                    html += "<li>" + val + "</li>";
		                });
		                $ul.html( html );
		                $ul.listview( "refresh" );
		                $ul.trigger( "updatelayout");
		            });
		        }
		    });
		});
			*/
		</script>
		
		<div data-role="page" id="myPage">
	    <div data-role="content">
	    <ul id="autocomplete" data-role="listview" data-inset="true" data-filter="true" data-filter-placeholder="Search House Id..." data-filter-theme="d"></ul>
	    </div><!-- /content -->
		</div>
    </body>
</html>